<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://img.icons8.com/color/48/pokeball-2.png" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="calculadora.css">
    <title>Calculadora</title>
</head>

<body>

    <div class="navbar">
        <h1 class="titulo">
            <img class="pokeIcon" src="imagens/pokeball-icon.png" type="image/png">
            Calculadora Pokémon - Derivadas e Integrais
            <img class="pokeIcon" src="imagens/pokeball-icon.png" type="image/png">
        </h1>
    </div>

    <div class="alternarModo">
        <button class="toggle-dark" onclick="alternarModo()">
            <img id="icone-tema" src="https://img.icons8.com/emoji/48/sun-emoji.png" alt="tema">
        </button>
    </div>



    <div class="calculadora" role="toolbar" aria-label="calculadora">
        <input type="text" id="funcao" placeholder="Digite a função (ex: x^2 + 3*x)">

        <div class="botoes btn-group me-2" role="group" aria-label="Numerais">

            <button type="button" class="btn " onclick="inserirInput(this)">9</button>
            <button type="button" class="btn " onclick="inserirInput(this)">8</button>
            <button type="button" class="btn " onclick="inserirInput(this)">7</button>

            <button type="button" class="btn " onclick="inserirInput(this)">+</button>
            <button type="button" class="btn " onclick="inserirInput(this)">-</button>
            <button type="button" class="limpar " onclick="apagar()">⌫</button>

            <button type="button" class="btn " onclick="inserirInput(this)">4</button>
            <button type="button" class="btn " onclick="inserirInput(this)">5</button>
            <button type="button" class="btn " onclick="inserirInput(this)">6</button>

            <button type="button" class="btn " onclick="inserirInput(this)">*</button>
            <button type="button" class="btn " onclick="inserirInput(this)">÷</button>
            <button type="button" class="limpar " onclick="limpartexto()">C</button>

            <button type="button" class="btn " onclick="inserirInput(this)">3</button>
            <button type="button" class="btn " onclick="inserirInput(this)">2</button>
            <button type="button" class="btn " onclick="inserirInput(this)">1</button>

            <button type="button" class="btn " onclick="inserirInput(this)">x</button>
            <button type="button" class="btn " onclick="inserirInput(this)">e</button>
            <button type="button" class="igual" onclick="executarCalculo()">Calcular</button>
            <button type="button" class="btn " onclick="inserirInput(this)">(</button>

            <button type="button" class="btn " onclick="inserirInput(this)">0</button>
            <button type="button" class="btn " onclick="inserirInput(this)">)</button>
            <button type="button" class="btn " onclick="inserirInput(this)">^</button>
            <button type="button" class="btn " onclick="inserirInput(this)">=</button>

        </div>

        <div class="resultados">
            <p id="resultado"></p>
        </div>
    </div>

    <script>
        function inserirInput(botao) {
            const visor = document.getElementById('funcao');
            visor.value += botao.innerText;
        }

        function limpartexto() {
            document.getElementById('funcao').value = '';
        }

        function apagar() {
            const visor = document.getElementById('funcao');
            visor.value = visor.value.slice(0, -1);
        }

        function alternarModo() {
            document.body.classList.toggle('dark-mode');
            const icone = document.getElementById('icone-tema');

            icone.classList.add('rotate');
            setTimeout(() => icone.classList.remove('rotate'), 300);

            icone.src = document.body.classList.contains('dark-mode') ?
                'https://img.icons8.com/emoji/48/new-moon-emoji.png' :
                'https://img.icons8.com/emoji/48/sun-emoji.png';
        }

    </script>

    <script type="module">

        import { realizarCalculos } from "./calculadoraCore.js";


        function executarCalculo() {
            const funcaoOriginal = document.getElementById('funcao').value;
            const intervaloMin = parseFloat(document.getElementById('intervaloMin').value);
            const intervaloMax = parseFloat(document.getElementById('intervaloMax').value);
            const integralInicio = parseFloat(document.getElementById('integralInicio').value);
            const integralFim = parseFloat(document.getElementById('integralFim').value);
            const numDivisoes = parseInt(document.getElementById('numDivisoes').value, 10);




            // Validação de inputs (repetida do exemplo anterior)
            if (!funcaoOriginal) {
                alert("Por favor, digite uma função para calcular.");
                return;
            }
            if (isNaN(intervaloMin) || isNaN(intervaloMax) || isNaN(integralInicio) || isNaN(integralFim) || isNaN(numDivisoes)) {
                alert("Por favor, preencha todos os parâmetros numéricos corretamente.");
                return;
            }
            if (numDivisoes <= 0) {
                alert("O número de divisões deve ser um inteiro positivo.");
                return;
            }
            if (intervaloMin >= intervaloMax) {
                alert("O intervalo mínimo para pontos críticos deve ser menor que o intervalo máximo.");
                return;
            }
            if (integralInicio >= integralFim) {
                alert("O ponto inicial da integral deve ser menor que o ponto final.");
                return;
            }

            try {
                // Chama a função central de cálculo (o motor)
                const resultados = realizarCalculos(funcaoOriginal, intervaloMin, intervaloMax, integralInicio, integralFim, numDivisoes);

                if (resultados.error) {
                    throw new Error(resultados.error + (resultados.details ? ` (${resultados.details})` : ''));
                }

                // Exibir resultados na página
                document.getElementById('res-funcao-original').innerText = funcaoOriginal;
                document.getElementById('res-primeira-derivada').innerText = resultados.primeiraDerivada;
                document.getElementById('res-segunda-derivada').innerText = resultados.segundaDerivada;
                document.getElementById('res-pontos-criticos').innerText = resultados.pontosCriticos.length > 0 ? resultados.pontosCriticos.join(', ') : 'Nenhum encontrado ou indefinido.';
                document.getElementById('res-maximos').innerText = resultados.classificacaoPontos.maximos.length > 0 ? resultados.classificacaoPontos.maximos.join(', ') : 'Nenhum.';
                document.getElementById('res-minimos').innerText = resultados.classificacaoPontos.minimos.length > 0 ? resultados.classificacaoPontos.minimos.join(', ') : 'Nenhum.';
                document.getElementById('res-inflexao').innerText = resultados.classificacaoPontos.inflexao.length > 0 ? resultados.classificacaoPontos.inflexao.join(', ') : 'Nenhum.';
                document.getElementById('res-integral-trapezio').innerText = resultados.integralTrapezio;
                document.getElementById('res-integral-simpson').innerText = resultados.integralSimpson;
                document.getElementById('res-integral-riemann-esquerda').innerText = resultados.integralRiemannEsquerda;
                document.getElementById('res-integral-riemann-meio').innerText = resultados.integralRiemannMeio;
                document.getElementById('res-integral-riemann-direita').innerText = resultados.integralRiemannDireita;

            } catch (erro) {
                console.error("Erro durante o cálculo:", erro);
                // Resetar resultados para "Erro" ou vazio em caso de falha
                document.getElementById('res-funcao-original').innerText = funcaoOriginal;
                document.getElementById('res-primeira-derivada').innerText = 'Erro';
                document.getElementById('res-segunda-derivada').innerText = 'Erro';
                document.getElementById('res-pontos-criticos').innerText = 'Erro';
                document.getElementById('res-maximos').innerText = 'Erro';
                document.getElementById('res-minimos').innerText = 'Erro';
                document.getElementById('res-inflexao').innerText = 'Erro';
                document.getElementById('res-integral-trapezio').innerText = 'Erro';
                document.getElementById('res-integral-simpson').innerText = 'Erro';
                document.getElementById('res-integral-riemann-esquerda').innerText = 'Erro';
                document.getElementById('res-integral-riemann-meio').innerText = 'Erro';
                document.getElementById('res-integral-riemann-direita').innerText = 'Erro';
                alert(`Ocorreu um erro ao calcular a função: ${erro.message}. Por favor, verifique a sintaxe da função ou os parâmetros.`);
            }
        }
        // Expor as funções ao escopo global (window) para que os onclicks no HTML funcionem
        window.inserirInput = inserirInput;
        window.limpartexto = limpartexto;
        window.apagar = apagar;
        window.alternarModo = alternarModo;
        window.executarCalculo = executarCalculo;


    </script>

</body>

</html>